# 플러그인 개발 길잡이

## **개요**
Peregrine은 플러그인 아키텍처를 채용하여 모든 런처 동작이 플러그인을 통해 이루어지며, 사용자는 플러그인을 통해 자신만의 런처 동작을 개발하고, 배포할 수 있습니다.

## **플러그인 작동 구조**
`peregrine-install-dir/plugins` 경로 아래 각 플러그인별 디렉토리가 존재합니다.
Peregrine은 이 경로 하위 디렉토리를 스캔하여 `plugin.xml`을 찾습니다. 발견하면 해당 디렉토리를 기준으로 플러그인 로드를 시작합니다.
플러그인은 **액션**들로 구성됩니다. **액션**은 QML로 기술된 UI를 띄울 수 있고, 자신에게로 넘어온 입력을 처리할 **컨트롤러**를 지정할 수 있습니다.
**컨트롤러**는 플랫폼이 요구하는 형태의 네이티브 모듈입니다. Windows의 경우 `.DLL` 파일, Linux 는 `.so` 파일이 됩니다. 
개발자는 **컨트롤러** 모듈에 **플러그인 컨트롤러 모듈 인터페이스**에 맞추어 제공할 기능을 개발합니다. 

## **플러그인 설치**
- 플러그인을 개발합니다. 그 결과, `plugin.xml`을 포함한 파일들이 생성됩니다.
- 플러그인 패키지 파일: 개발한 플러그인 파일들을 `.zip`으로 압축한 후 확장자를 `.wing`으로 변경합니다. 
- [설정] - [플러그인] - [플러그인 설치] 를 누르고 플러그인 패키지 파일을 지정하면 설치됩니다.

## **플러그인 컨트롤러 모듈 인터페이스**
아래 함수들은 컨트롤러가 구현하는 함수들입니다. C함수로 구현하며, 모듈 바깥에서 접근할 수 있어야 합니다.
예시는 리파지토리의 `plugins` 아래 기본 제공되는 플러그인들의 소스를 참고하세요. 

### **플러그인 수명 관련** 
* `InitializePlugin` 함수: 플러그인 로드시 호출됩니다. 플러그인에게 필요한 설정(`PG_PLUGIN_CONFIGS`)과, Peregrine이 제공하는 기능을 호출할 수 있는 함수 테이블(`PG_FUNC_TABLE`)이 인자로 넘어옵니다.
* `DeinitializePlugin` 함수(미구현): 플러그인 언로드시 호출됩니다.   

### **액션 관련**
* `RunAction` 함수: 액션이 실행됐을 경우 호출됩니다. 액션 아이디와 인자 목록(`PG_ACTION_ARGUMENT_SET`)이 전달됩니다. 예를 들면 `website-google-search` 액션은 넘어온 인자를 검색어로 하여 Google 검색 쿼리를 조립하고, 웹브라우저에게 전달하는 일을 합니다.

### **서제스천 관련**
* `GetSuggestionItems`: 사용자의 입력에 따라 제시할 서제스천을 제공합니다. 입력이 바뀔 때마다 호출됩니다. 예를 들면 `file`플러그인은 입력되는 단어와 매치되는 파일이름들을 반환합니다.
* `RunSuggestion`: 서제스천의 동작 방식엔 두 가지가 있습니다. 첫 번째 방식은 컨트롤러의 개입이 필요하지 않고, Peregrine이 처리할 수 있습니다. 두 번째 방식은 컨트롤러가 서제스천을 직접 처리하는 방식입니다. 이 경우 `RunSuggestion` 함수를 통해서 처리기를 구현합니다. 플러그인이 제시한 서제스천마다 `token`을 발급할 수 있습니다. 이 `token`은 각 서제스천 항목을 식별할 수 있게 해줍니다. Peregrine은 사용자가 실행한 서제스천의 `token`을 인자로 전달하여 플러그인에게 어떤 서제스천이 선택되었는지를 전달합니다.   
  * 자신 혹은 다른 액션을 호출 
  * 서제스천의 동작을 플러그인이 직접 처리 



